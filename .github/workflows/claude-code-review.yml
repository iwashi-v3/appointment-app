name: Claude Code Review

on:
  pull_request:
    types: [opened, synchronize]
    # Optional: Only run on specific file changes
    # paths:
    #   - "src/**/*.ts"
    #   - "src/**/*.tsx"
    #   - "src/**/*.js"
    #   - "src/**/*.jsx"

jobs:
  claude-review:
    # Optional: Filter by PR author
    # if: |
    #   github.event.pull_request.user.login == 'external-contributor' ||
    #   github.event.pull_request.user.login == 'new-developer' ||
    #   github.event.pull_request.author_association == 'FIRST_TIME_CONTRIBUTOR'

    runs-on: ubuntu-latest
    permissions:
      contents: read
      pull-requests: write
      issues: write
      id-token: write

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 1

      - name: Run Claude Code Review
        id: claude-review
        uses: anthropics/claude-code-action@v1
        with:
          claude_code_oauth_token: ${{ secrets.CLAUDE_CODE_OAUTH_TOKEN }}
          prompt: |
            PR #${{ github.event.pull_request.number }} ã®ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’å®Ÿæ–½ã—ã¦ãã ã•ã„ã€‚

            ## PRã®æƒ…å ±
            - PRç•ªå·: ${{ github.event.pull_request.number }}
            - ã‚¿ã‚¤ãƒˆãƒ«: ${{ github.event.pull_request.title }}
            - ãƒ–ãƒ©ãƒ³ãƒ: ${{ github.event.pull_request.head.ref }}
            
            ## å¿…é ˆã‚¿ã‚¹ã‚¯1 - ãƒªãƒã‚¸ãƒˆãƒªã®ã‚³ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹ã‚’ç†è§£ã™ã‚‹
            - ãƒªãƒã‚¸ãƒˆãƒªã®ä¸»è¦ãªè¨€èªã€ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã€ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’æŠŠæ¡ã—ã¦ãã ã•ã„ã€‚
            - ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¦ç´„ã‚„ã‚¹ã‚¿ã‚¤ãƒ«ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³ãŒã‚ã‚Œã°ã€ãã‚Œã«å¾“ã£ã¦ãã ã•ã„ã€‚
            - ãƒªãƒã‚¸ãƒˆãƒªã®CLAUDE.mdãƒ•ã‚¡ã‚¤ãƒ«ãŒã‚ã‚Œã°ã€ã‚¹ã‚¿ã‚¤ãƒ«ã‚„è¦ç´„ã®ã‚¬ã‚¤ãƒ€ãƒ³ã‚¹ã¨ã—ã¦å‚ç…§ã—ã¦ãã ã•ã„ã€‚

            ## å¿…é ˆã‚¿ã‚¹ã‚¯2 - PRã®å¤‰æ›´ç‚¹ã‚’æŠŠæ¡ã™ã‚‹
            ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ç”¨ã—ã¦ã€PRã®å·®åˆ†ã‚’å–å¾—ã—ã€å¤‰æ›´ç‚¹ã‚’æŠŠæ¡ã—ã¦ãã ã•ã„ã€‚
            ```bash
            gh pr diff ${{ github.event.pull_request.number }}
            ```

            ## å¿…é ˆã‚¿ã‚¹ã‚¯3 - ãƒ¬ãƒ“ãƒ¥ãƒ¼å®Ÿæ–½
            - ã‚³ãƒ¼ãƒ‰å“è³ªã¨ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹
            - æ½œåœ¨çš„ãªãƒã‚°ã‚„å•é¡Œ
            - ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã®è€ƒæ…®äº‹é …
            - ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¸Šã®æ‡¸å¿µ
            - ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸
            - ã‚¹ã‚³ã‚¢ãƒªãƒ³ã‚°(1-100ç‚¹)
            - Approve/Request Changesã®æ¨å¥¨

            ## å¿…é ˆã‚¿ã‚¹ã‚¯4 - ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚³ãƒ¡ãƒ³ãƒˆã®ä½œæˆ
            - ä¸Šè¨˜ã®ãƒ¬ãƒ“ãƒ¥ãƒ¼ã«åŸºã¥ã„ã¦ã€ä»¥ä¸‹ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã‚’å…ƒã«å…·ä½“çš„ã§å»ºè¨­çš„ãªãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚’æä¾›ã—ã¦ãã ã•ã„ã€‚
            - å¯èƒ½ã§ã‚ã‚Œã°ã€ã‚³ãƒ¼ãƒ‰ä¾‹ã‚„ä¿®æ­£æ¡ˆã‚’å«ã‚ã¦ãã ã•ã„ã€‚
            
            ```
            ## ğŸ“‹ Claude Code è‡ªå‹•ãƒ¬ãƒ“ãƒ¥ãƒ¼çµæœ
            ### å…¨ä½“çš„ãªãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯
            - PR: #${{ github.event.pull_request.number }}
            - ã‚¹ã‚³ã‚¢: XXç‚¹ / 100ç‚¹
            - åˆ¤å®š: âœ… Approve / ğŸ“ è¦ç¢ºèª

            ## ğŸ”é‡è¦ãªæŒ‡æ‘˜
            1. [Must / Question / Suggestion / Nits] - æŒ‡æ‘˜å†…å®¹
               - è©³ç´°èª¬æ˜
               - ä¿®æ­£æ¡ˆã‚„ã‚³ãƒ¼ãƒ‰ä¾‹ï¼ˆå¯èƒ½ã§ã‚ã‚Œã°ï¼‰
            2. [Must / Question / Suggestion / Nits] - æŒ‡æ‘˜å†…å®¹
               - è©³ç´°èª¬æ˜
               - ä¿®æ­£æ¡ˆã‚„ã‚³ãƒ¼ãƒ‰ä¾‹ï¼ˆå¯èƒ½ã§ã‚ã‚Œã°ï¼‰
            3. [Must / Question / Suggestion / Nits] - æŒ‡æ‘˜å†…å®¹
               - è©³ç´°èª¬æ˜
               - ä¿®æ­£æ¡ˆã‚„ã‚³ãƒ¼ãƒ‰ä¾‹ï¼ˆå¯èƒ½ã§ã‚ã‚Œã°ï¼‰
            
            ## ğŸ“Š è¦³ç‚¹åˆ¥è©•ä¾¡
            (å„è¦–ç‚¹ã”ã¨ã«è©•ä¾¡ã¨ã‚³ãƒ¡ãƒ³ãƒˆã‚’è¨˜è¼‰)
            ```

            ## å¿…é ˆã‚¿ã‚¹ã‚¯5 - ã‚³ãƒ¡ãƒ³ãƒˆã®æŠ•ç¨¿ã¨æ‰¿èªæ¨å¥¨ (å¿…é ˆ)
            â€»æ³¨æ„: å¿…ãš `Bash` ãƒ„ãƒ¼ãƒ«ã‚’ä½¿ç”¨ã—ã¦å®Ÿéš›ã«ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚
            â€»é‡è¦: PRç•ªå· ${{ github.event.pull_request.number }} ã‚’å¿…ãšæŒ‡å®šã—ã¦ãã ã•ã„ã€‚
            â€»å¿…é ˆ: ã©ã¡ã‚‰ã®æ¡ä»¶ã§ã‚‚ã€å¿…ãšä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã®ã„ãšã‚Œã‹ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚

            **ã€ãƒ‘ã‚¿ãƒ¼ãƒ³1ã€‘Approveã™ã‚‹å ´åˆ**
            ```bash
            gh pr review ${{ github.event.pull_request.number }} --approve --body "(å¿…é ˆã‚¿ã‚¹ã‚¯3ã§ä½œæˆã—ãŸã‚³ãƒ¡ãƒ³ãƒˆå†…å®¹)"
            ```

            **ã€ãƒ‘ã‚¿ãƒ¼ãƒ³2ã€‘Request Changesã™ã‚‹å ´åˆ**
            ```bash
            gh pr comment ${{ github.event.pull_request.number }} --request-changes --body "(å¿…é ˆã‚¿ã‚¹ã‚¯3ã§ä½œæˆã—ãŸã‚³ãƒ¡ãƒ³ãƒˆå†…å®¹)"
            ```

            âš ï¸ **çµ¶å¯¾ã«å®ˆã‚‹ã“ã¨**: ãƒ‘ã‚¿ãƒ¼ãƒ³Aã¾ãŸã¯ãƒ‘ã‚¿ãƒ¼ãƒ³Bã®ã©ã¡ã‚‰ã‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å¿…ãšå®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ãªã„ã“ã¨ã¯è¨±å¯ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚

          # See https://github.com/anthropics/claude-code-action/blob/main/docs/usage.md
          # or https://docs.claude.com/en/docs/claude-code/cli-reference for available options
          claude_args: |
            '--allowed-tools "Bash(gh issue view:*),Bash(gh search:*),Bash(gh issue list:*),Bash(gh pr comment:*),Bash(gh pr review:*),Bash(gh pr diff:*),Bash(gh pr view:*),Bash(gh pr list:*)"'

